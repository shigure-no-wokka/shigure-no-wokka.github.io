---
title: 游戏开发经验分享 Part2 防御式编程
pubDate: 2024-09-17 00:48
description: 利用防御式编程防止系统崩溃
image: https://raw.githubusercontent.com/shigure-no-wokka/pic_bed/main/imgs/family_frag.jpg
categories: 
    - Frag
tags:
    - GameDevelopment
    - DefensiveProgramming
---

在目前的工作中, 遇到了不少意外报错的情况, 策划配表错误, 数据遗漏, 因为其他模块的 error 导致本人负责的模块收到错误的数据等等

为了想办法避免这种崩溃情况, 了解到了**防御式编程**这种思想

<!--more-->

## 来自跑路老哥传授的"经验遗产"

根据已经跑路的同事传授的经验, 在服务端要**保证所有操作的原子性**

以武器的装备和移除举例:

想要给角色装备武器, 则必须先将角色当前武器移除, 即: 装备操作一定发生在移除操作之后

所以当服务端接收到给角色装备武器的指令时, 要保证移除指令优先发生, 那么就需要提前在服务端设计好相应的指令顺序, 避免未卸下当前武器就装备而出现错误


## 本人负责模块的"防御工事"

> 编程语言为: Lua

目前遇到过的非本人代码导致的崩溃问题有
- 配表结构变动, 导致属性无法获取
- 配表数据未配置, 导致数值计算无法进行
- 接收到错误的 ID 导致后续无法获取有效数据
- 结构体发生变化

> 改动需求后不和程序对齐, 是这个项目组中存在的最大的问题
> 发生变动后, 反而是需要程序这边去确认, 任务量转给了程序, 逆天
> 改就改, 程序这边发发牢骚也就改了, 而不是改动了却不说, 导致更新主干后运行直接报错, 反而成了程序的 bug 单

在程序进行开发之前, 就需要确定好属性结构, 并确保某些重要的属性结构不会在后续发生大的改动

否则在开发过程中所需要的配表结构都具有不确定性, 增加了太多不必要的判空操作

> 可惜

目前只能在代码中增加众多的判空 return


